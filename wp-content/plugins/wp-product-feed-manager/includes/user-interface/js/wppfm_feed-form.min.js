var _mandatoryFields=[];var _highlyRecommendedFields=[];var _recommendedFields=[];var _undefinedRecommendedOutputs=[];var _definedRecommendedOutputs=[];var _optionalFields=[];var _undefinedOptionalOutputs=[];var _definedOptionalOutputs=[];var _undefinedCustomOutputs=[];var _customFields=[];var _inputFields=[];var _feedHolder;function wppfm_mainInputChanged(c){var b=jQuery("#merchants").val();var a=_feedHolder.feedId;wppfm_reactOnChannelInputChanged(b,a,c)}function wppfm_validateFileName(){if(!wppfm_contains_special_characters(jQuery("#file-name").val())){_feedHolder.title=jQuery("#file-name").val()}else{alert(wppfm_feed_settings_form_vars.prohibited_feed_name_characters);jQuery("#file-name").val("")}}function wppfm_freeCategoryChanged(a,b){if(a==="default"){if(b){if(b>0){_feedHolder.setCustomCategory(undefined,jQuery("#free-category-text-input").val())}else{wppfm_mainInputChanged(true)}}else{wppfm_mainInputChanged(true)}}else{_feedHolder.changeCustomFeedCategoryMap(b,jQuery("#feed-category-"+b+" :input").val())}}function wppfm_constructNewFeed(){var s=jQuery("#file-name").val();var i="1";var d=jQuery("#lvl_0 option:selected").text();var q=[];var t=jQuery("#merchants").val();var e=jQuery("#variations").is(":checked")?1:0;var j=jQuery("#aggregator").is(":checked")?1:0;var m=jQuery("#countries").val();var k=document.getElementById("language")===null?"":jQuery("#language").val();var r=jQuery("#google-feed-title-selector").val();var h=jQuery("#google-feed-description-selector").val();var g=jQuery("#days-interval").val()!==""?jQuery("#days-interval").val():"1";var p=jQuery("update-schedule-hours").val()!==""?jQuery("update-schedule-hours").val():"00";var o=jQuery("update-schedule-minutes").val()!==""?jQuery("update-schedule-minutes").val():"00";var f=jQuery("update-schedule-frequency").val()!==""?jQuery("update-schedule-frequency").val():"1";var n=[];var l=2;var a=wppfm_getChannelFeedType(t);var b=jQuery("#wp-plugin-url").text()+"/wppfm-feeds/"+s+"."+a;var c=g+":"+p+":"+o+":"+f;wppfm_setScheduleSelector(g,f);_feedHolder=new Feed(-1,s,e,j,parseInt(t),d,q,b,i,m,k,r,h,c,n,l)}function wppfm_finishOrUpdateFeedPage(b){wppfm_show_feed_spinner();var a=jQuery("#merchants").val().toString();_feedHolder.title=jQuery("#file-name").val();_feedHolder.channel=jQuery("#merchants").val();_feedHolder.includeVariations=jQuery("#variations").is(":checked")?"1":"0";_feedHolder.isAggregator=jQuery("#aggregator").is(":checked")?"1":"0";_feedHolder.feedTitle=jQuery("#google-feed-title-selector").val();_feedHolder.feedDescription=jQuery("#google-feed-description-selector").val();_feedHolder.language=document.getElementById("language")===null?"":jQuery("#language").val();wppfm_outputFields(-1,a,function(c){_feedHolder.setUpdateSchedule(jQuery("#days-interval").val(),jQuery("#update-schedule-hours").val(),jQuery("#update-schedule-minutes").val(),jQuery("#update-schedule-frequency").val());if(undefined===_feedHolder.attributes||0===_feedHolder.attributes.length){wppfm_addFeedAttributes(c,a,1)}wppfm_customSourceFields(_feedHolder.dataSource,function(d){_feedHolder.country=jQuery("#countries").val();wppfm_fillSourcesList(d);wppfm_mainFeedFilters(_feedHolder.feedId,function(g){var f=g!==1?g:null;_feedHolder.setFeedFilter(f);_feedHolder=wppfm_setOutputAttributeLevels(a,_feedHolder,_feedHolder.country);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);if(b){_feedHolder.mainCategory=jQuery("#lvl_0").val()?jQuery("#lvl_0").val():jQuery("#free-category-text-input").val();_feedHolder.setMainCategory("lvl_0",jQuery("#lvl_0").val(),a)}wppfm_makeFieldsTable();if(_feedHolder!==0){var e=_feedHolder.feedId===-1?true:false;wppfm_fillFeedFields(e,b)}_feedHolder.channel=a;wppfm_hide_feed_spinner()})})})}function wppfm_editExistingFeed(a){wppfm_show_feed_spinner();wppfm_getFeedObject(a,function(e){_feedHolder=e;var c=_feedHolder.channel;var b=_feedHolder.mainCategory;var d=b&&b.indexOf(" > ")>-1?b.substring(0,b.indexOf(" > ")):b;wppfm_fillCategoryVariables(c,d,0);wppfm_outputFields(_feedHolder.feedId,c,function(f){wppfm_addFeedAttributes(f,c,1);wppfm_customSourceFields(_feedHolder.dataSource,function(g){wppfm_fillSourcesList(g);wppfm_mainFeedFilters(a,function(i){var h=i!==1?i:null;_feedHolder.setFeedFilter(h);_feedHolder=wppfm_setOutputAttributeLevels(c,_feedHolder,_feedHolder.country);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);wppfm_makeFieldsTable();if(_feedHolder!==0){wppfm_fillFeedFields(false,false)}if(_feedHolder.categoryMapping){wppfm_setCategoryMap(_feedHolder.categoryMapping)}wppfm_enableFeedActionButtons();jQuery("#countries").prop("disabled",false);wppfm_fillDefaultCategorySelectors();wppfm_setIdentifierExistsDependancies();wppfm_hide_feed_spinner()})})})})}function wppfm_fillSourcesList(a){_inputFields=wppfm_woocommerceSourceOptions();wppfm_addCustomFieldsToInputFields(_inputFields,a);_inputFields.sort(function(d,c){return(""+d.label).toUpperCase()<(""+c.label).toUpperCase()?-1:1})}function wppfm_saveUpdateSchedule(){var d=jQuery("#days-interval").val();var a=jQuery("#update-schedule-hours").val();var b=jQuery("#update-schedule-minutes").val();var c=jQuery("#update-schedule-frequency").val();if(d!=="1"){c="1"}if(c===1){d="1"}wppfm_setScheduleSelector(d,c);_feedHolder.setUpdateSchedule(d,a,b,c)}function wppfm_setScheduleSelector(b,a){if(b==="1"){jQuery("#wppfm-update-frequency-wrapper").show()}else{jQuery("#wppfm-update-frequency-wrapper").hide()}if(a>1){jQuery("#wppfm-update-day-wrapper").hide();jQuery("#wppfm-update-every-day-wrapper").show()}else{jQuery("#wppfm-update-day-wrapper").show();jQuery("#wppfm-update-every-day-wrapper").hide()}}function wppfm_addCustomFieldsToInputFields(b,d){if(d!=="0"){for(var a=0;a<d.length;a++){var c={value:d[a].attribute_name,label:d[a].attribute_label,prop:"custom"};b.push(c)}}}function wppfm_fillDefaultCategorySelectors(){var b=_feedHolder.mainCategory;var a=_feedHolder.channel;var c=wppfm_channelCountryCode(a);wppfm_getCategoryListsFromString(a,b,c,function(f){var d=JSON.parse(f);if(d&&d.length>0&&b!==undefined){var e=b.split(" > ");for(var h=0;h<d.length;h++){jQuery("#lvl_"+h).append(wppfm_categorySelectCntrl(d[h]));var g=document.getElementById("lvl_"+h);g.value=e[h]}}else{jQuery("#lvl_0").prop("disabled",false)}})}function wppfm_google_feed_title_changed(){_feedHolder.feedTitle=jQuery("#google-feed-title-selector").val()}function wppfm_google_feed_description_changed(){_feedHolder.feedDescription=jQuery("#google-feed-description-selector").val()}function wppfm_feed_language_changed(){_feedHolder.language=jQuery("#language").val()}function wppfm_setCategoryMap(a){var d=JSON.parse(a);for(var b=0;b<d.length;b++){var c=d[b].shopCategoryId;var e="";switch(d[b].feedCategories){case"wp_mainCategory":e=wppfm_mapToDefaultCategoryElement(c,"default");break;case"wp_ownCategory":e=wppfm_mapToDefaultCategoryElement(c,"shopCategory");break;default:e=wppfm_mapToCategoryElement(c,d[b].feedCategories);break}jQuery("#feed-selector-"+c).prop("checked",true);jQuery("#feed-category-"+c).html(e)}}function wppfm_generateAndSaveFeed(){wppfm_show_feed_spinner();_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:wppfm_feed_settings_form_vars.no_category_required;wppfm_saveFeedToDb(_feedHolder,function(b){var a=_feedHolder.feedId===-1?true:false;if(b===0){console.log("Saving the data to the data base has failed!");wppfm_show_error_message(wppfm_feed_settings_form_vars.save_data_failed)}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}wppfm_updateFeedFile(_feedHolder.feedId,function(d){if(!a){wppfm_hide_feed_spinner()}switch(d){case"started_processing":jQuery("#error-message").hide();wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_started);wppfm_alert_update_finished(_feedHolder.feedId);break;case"pushed_to_queue":jQuery("#error-message").hide();wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_queued);wppfm_alert_update_finished(_feedHolder.feedId);break;case"writing_error":wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_writing_error);wppfm_hide_feed_spinner();break;case"foreground_processing_complete":wppfm_alert_update_finished(_feedHolder.feedId,0);wppfm_hide_feed_spinner();break;case"1":case 1:wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_general_error.replace("%xmlResult%",d));wppfm_hide_feed_spinner();break;default:wppfm_hide_feed_spinner()}})})}function wppfm_alert_update_finished(a,b){if(undefined===b||0===b){b=5000}var d=window.setInterval(c,b,a);if(!a){return false}function c(e){wppfm_getCurrentFeedStatus(e,function(f){var g=JSON.parse(f);console.log("Feed status changed to status "+g.status_id);switch(g.status_id){case"0":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_unknown.replace("%feedname%",g.title));window.clearInterval(d);break;case"1":case"2":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_ready.replace("%feedname%",g.title).replace("%prodnr%",g.products));window.clearInterval(d);break;case"3":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_still_processing);break;case"4":wppfm_show_success_message(wppfm_feed_settings_form_vars.feed_status_added_to_queue);break;case"5":jQuery("#success-message").hide();wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_status_error.replace("%feedname%",g.title));window.clearInterval(d);break;case"6":jQuery("#success-message").hide();wppfm_show_error_message(wppfm_feed_settings_form_vars.feed_status_failed.replace("%feedname%",g.title));window.clearInterval(d);break}})}}function wppfm_saveFeed(){wppfm_show_feed_spinner();var a=_feedHolder.feedId===-1?true:false;_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:wppfm_feed_settings_form_vars.no_category_required;if(a){_feedHolder.url=wppfm_feed_settings_form_vars.no_feed_generated}wppfm_saveFeedToDb(_feedHolder,function(b){if(b===0){console.log("Saving the data to the data base has failed!");wppfm_show_error_message(wppfm_feed_settings_form_vars.save_data_failed)}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}wppfm_hide_feed_spinner()})}function wppfm_nextCategory(a){var b=wppfm_incrementLast(a);var e=b.match(/(\d+)$/)[0];var d=jQuery("#"+a).val();var c=_feedHolder.channel?_feedHolder.channel.toString():jQuery("#merchants").val();var f=wppfm_channelCountryCode(c);if(e>1){wppfm_show_feed_spinner()}wppfm_hideSubs(a);wppfm_fillCategoryVariables(c,d,a);wppfm_getNextCategories(c,e,d,f,function(g){var h=JSON.parse(g);if(h.length>0){jQuery("#"+b).append(wppfm_categorySelectCntrl(h));jQuery("#"+b).show()}if(a.indexOf("catmap")>-1){wppfm_setChildCategories(a,d)}else{_feedHolder.setMainCategory(a,d,c);if(_feedHolder.attributes.length>0&&_feedHolder.attributes[3]["value"]!==undefined&&_feedHolder.attributes[3]["value"]!==""){jQuery("#category-source-string").html(JSON.parse(_feedHolder.attributes[3]["value"]).t)}else{jQuery("#category-source-string").html(_feedHolder.mainCategory)}}if(e>1){wppfm_hide_feed_spinner()}})}function wppfm_setChildCategories(c,f){var e=c.match(/(\d+)$/)[0];var g=c.replace("_"+e,"");var d=g.match(/(\d+)$/)[0];var b=wppfm_getCategoryChildren(d);for(var a=0;a<b.length;a++){wppfm_setChildrenToParentCategory(d,b[a],e,f)}_feedHolder.mapCategory(c,f)}function wppfm_getCategoryChildren(a){return jQuery("#feed-selector-"+a).attr("data-children")?JSON.parse(jQuery("#feed-selector-"+a).attr("data-children")):[]}function wppfm_variation_selection_changed(){alert(wppfm_feed_settings_form_vars.variation_only_for_premium);_feedHolder.changeIncludeVariations(false);jQuery("#variations").prop("checked",false)}function wppfm_aggregatorChanged(){if(jQuery("#aggregator").is(":checked")){_feedHolder.changeAggregator(true);_feedHolder.attributes[8]["fieldLevel"]="1"}else{_feedHolder.changeAggregator(false);_feedHolder.attributes[8]["fieldLevel"]="0";_feedHolder.deactivateAttribute("8")}}function wppfm_setChildrenToParentCategory(g,e,a,d){var h=wppfm_getCategorySelectorValue(e);var c="";var k=wppfm_addNewItemToCategoryString(a,h,d," > ");var l="catmap-"+e+"_"+a;for(var f=0;f<a;f++){c+=jQuery("#catmap-"+g+"_"+f).val()+" > "}var j=c.substring(0,c.length-3);if(h===j||h===wppfm_feed_settings_form_vars.map_to_default_category){if("#category-text-span-"+e.length===0){wppfm_mapToDefaultCategoryElement(e,k)}jQuery("#category-text-span-"+e).text(k);var b=jQuery("#feed-selector-"+e).attr("data-children")?JSON.parse(jQuery("#feed-selector-"+e).attr("data-children")):[];for(var f=0;f<b.length;f++){wppfm_setChildrenToParentCategory(e,b[f],a,d)}_feedHolder.mapCategory(l,d)}else{if(jQuery("#category-text-span-"+e).length===0){jQuery("#feed-category-"+e).html(wppfm_mapToDefaultCategoryElement(e,h));jQuery("#category-selector-catmap-"+e).hide()}}}function wppfm_getCategorySelectorValue(c){var e=jQuery("#category-text-span-"+c).text();if(e===""){var d="";for(var b=0;b<7;b++){var a=jQuery("#catmap-"+c+"_"+b).val();if(a!==null&&a!=="0"){d+=jQuery("#catmap-"+c+"_"+b).val()+" > "}}e=d.substring(0,d.length-3)}return e}function wppfm_fillFeedFields(f,c){var g=document.getElementById("language");if(_feedHolder.mainCategory&&f===false){if(!c){var h=_feedHolder.mainCategory+' (<a class="edit-categories wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="categories" onclick="wppfm_editCategories()">'+wppfm_feed_settings_form_vars.edit+"</a>)";jQuery("#lvl_0").hide();jQuery("#selected-categories").html(h);jQuery("#selected-merchant").html(jQuery("#merchants option[value='"+_feedHolder.channel+"']").text());jQuery("#merchants").hide()}}else{jQuery("#lvl_0").css("display","initial")}var e=_feedHolder.updateSchedule?_feedHolder.updateSchedule.split(":"):[];if(!f){wppfm_showChannelInputs(_feedHolder.channel,f)}else{jQuery("#category-map").show()}jQuery("#file-name").val(_feedHolder.title);jQuery("#merchants").val(_feedHolder.channel);jQuery("#variations").prop("checked",_feedHolder.includeVariations>0?true:false);jQuery("#aggregator").prop("checked",_feedHolder.isAggregator>0?true:false);jQuery("#countries").val(_feedHolder.country);jQuery("#google-feed-title-selector").val(_feedHolder.feedTitle);jQuery("#google-feed-description-selector").val(_feedHolder.feedDescription);jQuery("#days-interval").val(e[0]);if(g!==null){var a=_feedHolder.language!==""?_feedHolder.language:"0";jQuery("#language").val(a)}var d=document.getElementById("update-schedule-hours");var b=document.getElementById("update-schedule-minutes");var i=document.getElementById("update-schedule-frequency");d.value=e[1];b.value=e[2];i.value=e[3]?e[3]:"1";wppfm_setScheduleSelector(e[0],e[3])}function wppfm_categorySelectCntrl(a){var c='<option value="0">'+wppfm_feed_settings_form_vars.select_a_sub_category+"</option>";for(var b=0;b<a.length;b++){c+='<option value="'+a[b]+'">'+a[b]+"</option>"}return c}function wppfm_editCategoryMapping(e){wppfm_show_feed_spinner();var c=_feedHolder.channel;var d=wppfm_channelCountryCode(c);var b=jQuery("#category-text-span-"+e).text();var a=b.split(" > ");if(b&&b!==wppfm_feed_settings_form_vars.map_to_default_category){wppfm_getCategoryListsFromString(c,b,d,function(f){wppfm_showCategoryMappingSelectors(e,JSON.parse(f),a);wppfm_hide_feed_spinner()})}else{if(!wppfm_isCustomChannel(c)){wppfm_getCategoryListsFromString(c,"",d,function(f){wppfm_showCategoryMappingSelectors(e,JSON.parse(f),"");wppfm_hide_feed_spinner()})}else{jQuery("#feed-category-"+e).html(wppfm_freeCategoryInputCntrl("mapping",e,_feedHolder.mainCategory));jQuery("#category-selector-catmap-"+e).hide();wppfm_hide_feed_spinner()}}}function wppfm_childrensValue(j){var d=wppfm_getCategoryChildren(j);var b="";var f=[];var a=false;for(var e=0;e<d.length;e++){b=wppfm_getCategorySelectorValue(d[e]);if(b!=="0"&&b!==wppfm_feed_settings_form_vars.map_to_default_category){a=b;jQuery("#feed-category-"+d[e]).html(wppfm_mapToDefaultCategoryElement(d[e],a));jQuery("#category-selector-catmap-"+d[e]).hide()}else{f.push(d[e])}}if(!a){return a}var h=(a.match(/ > /g)||[]).length;for(var g=0;g<f.length;g++){wppfm_setChildrenToParentCategory(j,f[g],h,a)}return a}function wppfm_showCategoryMappingSelectors(e,c,a){for(var b=0;b<c.length;b++){if(c[b]&&c[b].length>0){var d=a[b]?a[b]:"0";jQuery("#catmap-"+e+"_"+b).append(wppfm_categorySelectCntrl(c[b]));jQuery("#catmap-"+e+"_"+b).val(d);jQuery("#catmap-"+e+"_"+b).show()}jQuery("#catmap-"+e+"_"+b).prop("disabled",false)}jQuery("#feed-category-"+e).html("");jQuery("#category-selector-catmap-"+e).show()}function wppfm_activateOptionalFieldRow(e,a){var c=_feedHolder.getAttributeIdByName(a);_feedHolder.activateAttribute(c);if(_feedHolder.attributes[c]["advisedSource"]){_feedHolder.setSourceValue(c,e,_feedHolder.attributes[c]["advisedSource"])}var b=wppfm_fieldRow(_feedHolder.attributes[c],true);var d=-1;if(e===3){d=_undefinedRecommendedOutputs.indexOf(a)}else{if(e===4){d=_undefinedOptionalOutputs.indexOf(a)}}if(d>-1){if(e===3){_undefinedRecommendedOutputs.splice(d,1)}else{if(e===4){_undefinedOptionalOutputs.splice(d,1)}}}if(e===3){_definedRecommendedOutputs.push(_feedHolder.attributes[c]["fieldName"]);_definedRecommendedOutputs.sort()}else{if(e===4){_definedOptionalOutputs.push(_feedHolder.attributes[c]["fieldName"]);_definedOptionalOutputs.sort()}}jQuery("#output-field-cntrl-"+e+" option[value='"+a+"']").remove();jQuery("#output-field-cntrl-"+e).val("no-value");if(e===3){jQuery("#new-recommended-row").append(b);jQuery("#new-recommended-row").show()}else{if(e===4){jQuery("#new-optional-row").append(b)}}}function wppfm_deactivateOptionalFieldRow(b,c,a){_feedHolder.deactivateAttribute(b);jQuery("#output-field-cntrl-"+c).append("<option value='"+a+"'>"+a+"</option>");jQuery("#row-"+b).html("");jQuery("#new-recommended-row").hide()}function wppfm_activateCustomFieldRow(b){if(!_feedHolder.checkIfCustomNameExists(b)){var a=_feedHolder.getAttributeIdByName(b);_feedHolder.addAttribute(a,b,"",undefined,"5",true,0,0,0,0);jQuery("#new-custom-row").append(wppfm_fieldRow(_feedHolder.attributes[a],true));jQuery("#new-custom-row").show()}else{alert(wppfm_feed_settings_form_vars.duplicated_field.replace("%fieldname%",b))}jQuery("#custom-output-title-input").val("")}function wppfm_setStaticValue(b,a,d){var c=jQuery("#static-input-field-"+b+"-"+a+"-"+d).val();if(c===undefined){c=jQuery("#static-condition-input-"+b+"-"+a+"-"+d+" option:selected").val()}_feedHolder.setStaticAttributeValue(b,a,d,c)}function wppfm_setIdentifierExistsDependancies(){var a=jQuery("#static-input-field-34-0").val();if(a===undefined){a=jQuery("#static-condition-input-34-0 option:selected").val()}switch(a){case"true":wppfm_resetOutputField(12,1,true);wppfm_resetOutputField(13,1,true);break;case"false":wppfm_resetOutputField(12,3,false);wppfm_resetOutputField(13,3,false);break;default:break}}function wppfm_resetOutputField(b,f,c){var d=_feedHolder.attributes[b]["fieldLevel"];_feedHolder.attributes[b]["fieldLevel"]=f;_feedHolder.attributes[b]["isActive"]=c;var a=wppfm_fieldRow(_feedHolder.attributes[b],false);var e=_feedHolder.attributes[b]["fieldName"];if(c){jQuery("#required-field-table").append(a);jQuery("#output-field-cntrl-"+d+" option[value='"+e+"']").remove();jQuery("#recommended-field-table #row-"+b).remove()}else{jQuery("#row-"+b).replaceWith("");jQuery("#output-field-cntrl-"+f).append('<option value="'+e+'">'+e+"</option>")}}function wppfm_fieldRow(f,a){var g=f.rowId;var d=_feedHolder.getSourceObject(g);var b=countSources(d.mapping);if(d.advisedSource&&wppfm_hasExtraSourceRow(b,d.mapping)){b++}var e='<div class="field-table-row-wrapper" id="row-'+g+'">';for(var c=0;c<b;c++){e+=wppfm_addFeedSourceRow(g,c,d,_feedHolder.channel,a)}for(var c=0;c<d.changeValues.length;c++){if(d.changeValues[0]){e+=wppfm_valueEditor(d.rowId,c,c,d.changeValues)}}e+=wppfm_endrow(g);e+="</div>";return e}function wppfm_addSourceDataAndQueriesColumn(c,o){var k="";var d=o.rowId+"-"+c;var m=wppfm_getMappingSourceValue(o.mapping,c);var f=wppfm_getMappingCombinedValue(o.mapping,c);var h=wppfm_getMappingStaticValue(o.mapping,c);var b=o.customCondition?true:false;var a=m||f||h?true:false;var g=_feedHolder.channel.toString();var l=wppfm_getMappingConditions(o.mapping,c);var n=wppfm_countObjectItems(l);k+='<div class="source-selector colw col30w" id="source-select-'+d+'">';if(b){k+=wppfm_categorySource()}else{if((o.advisedSource&&!a&&o.advisedSource!==wppfm_feed_settings_form_vars.fill_with_static_value)||o.advisedSource===m){var j=jQuery.grep(_inputFields,function(i){return i.value===o.advisedSource});j=j[0]?j[0].label:o.advisedSource;k+=wppfm_advisedSourceSelector(o.rowId,c,j,g,o.mapping)}else{if((!o.advisedSource&&!m)||a||o.advisedSource===wppfm_feed_settings_form_vars.fill_with_static_value){k+=wppfm_inputFieldCntrl(o.rowId,c,m,h,o.advisedSource,f,wppfm_isCustomChannel(g));if(h){k+=wppfm_feedStaticValueSelector(o.fieldName,o.rowId,c,0,h,g)}if(f){k+=wppfm_combinedField(o.rowId,c,0,f,false,g)}}}}k+="</div>";k+='<div class="condition-selector colw" id="condition-data-'+d+'">';if(!b&&!l){k+='<div class="condition-wrapper" id="condition-'+d+'-0">';k+=wppfm_forAllProductsCondition(o.rowId,c,"initial");k+="</div>"}else{if(l){for(var e=0;e<n;e++){k+=wppfm_conditionSelectorCode(o.rowId,c,e,n,l[e])}}}k+="</div>";return k}function wppfm_addCombinedField(b,a,h){var c=true;for(var d=0;d<h;d++){if(jQuery("#combined-input-field-cntrl-"+b+"-"+a+"-"+h).val()==="select"){c=false;d=h}if(jQuery("#combined-input-field-cntrl-"+b+"-"+a+"-"+h).val()==="static"&&jQuery("#static-input-field-"+b+"-"+a+"-"+h).val()===""){c=false;d=h}}if(c){var f=_feedHolder.attributes[b]["value"]?JSON.parse(_feedHolder.attributes[b]["value"]):{};var g="m" in f?f.m:{};var e=wppfm_getMappingCombinedValue(g,a);var j=h>0?true:false;jQuery("#source-select-"+b+"-"+a).append(wppfm_combinedField(b,a,h,e,j));jQuery("#add-combined-field-"+b+"-"+a--).hide()}else{alert(wppfm_feed_settings_form_vars.select_all_source_fields_warning)}}function wppfm_combinedField(c,a,j,e,l){jQuery("#combined-wrapper-"+c+"-"+a).remove();var f=wppfm_splitCombinedFieldElements(e);var k=e?f.length:2;if(l){k++}var h='<div class="combined-wrapper" id="combined-wrapper-'+c+"-"+a+'">';for(var d=0;d<k;d++){var g=f[d];var b=g?g.indexOf("#"):0;if(g){var m=g.substr(0,b)!=="static"?[g.substr(0,b),g.substr(b+1)]:["0",f[d]]}else{var m=[]}h+=wppfm_combinedCntrl(c,a,d+1,k,"delete",m,_feedHolder.channel)}h+="</div>";return h}function wppfm_combinedCntrl(b,a,d,c,g,h,e){var f="";var i=_feedHolder.attributes[b]["fieldName"];f+='<span class="combined-field-row" id="combined-field-row-'+b+"-"+a+"-"+d+'">';if(d>1){f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0])}f+=wppfm_combinedInputFieldCntrl(b,a,d,h[1],i,e);if(g==="initialize"){f+='<span class="combined-field-row" id="combined-field-row">';f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0]);f+=wppfm_combinedInputFieldCntrl(b,a,2,"",i,e);f+='<div class="static-value-control" id="static-value-control-'+b+"-"+a+'-2"></div>'}if(d>2){f+='<span id="remove-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="remove-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_removeCombinedField('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.remove+"</a>)</span>"}if(d===2||d>=c){if(d===1){d++}if(d>=c){f+='<span id="add-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="add-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_addCombinedField('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.add+"</a>)</span>"}}f+="</span>";return f}function wppfm_ifConditionSelector(c,b,h,a,g){var d="";var e=wppfm_isEmptyQueryObject(g)?wppfm_makeCleanQueryObject():g;var i=wppfm_feed_settings_form_vars.if_pref+" ";if(h>1){i=e.preCondition==="1"?'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2">'+wppfm_feed_settings_form_vars.or+'</option><option value="1" selected>'+wppfm_feed_settings_form_vars.and+"</option></select>":'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2" selected>'+wppfm_feed_settings_form_vars.or+'</option><option value="1">'+wppfm_feed_settings_form_vars.and+"</option></select>"}var f="wppfm_storeCondition("+c+", "+b+", "+h+")";d+='<div class="condition-wrapper" id="condition-'+c+"-"+b+"-"+h+'">';d+=i;d+=wppfm_conditionFieldCntrl(c,b,h,-1,"input-field-cntrl",e.source,f);d+=wppfm_conditionQueryCntrl(c,b,h,-1,"query-condition","wppfm_queryConditionChanged",e.condition);d+='<input type="text" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" name="condition-value" id="condition-value-';d+=c+"-"+b+"-"+h+'" value="'+e.value+'"';if(g.condition!=="4"&&g.condition!=="5"){d+=' style="display:initial">'}else{d+=' style="display:none;">'}if(g.condition!=="14"){d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:none;"> '+wppfm_feed_settings_form_vars.and+' <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'"></span>'}else{d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:initial"> '+wppfm_feed_settings_form_vars.and+' <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'" value="'+g.endValue+'"></span>'}d+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+c;d+='" onclick="wppfm_removeCondition('+c+", "+b+", "+(h-1)+')">'+wppfm_feed_settings_form_vars.remove+"</a>)";if(h>=a){d+='<span id="add-edit-condition-'+c+"-"+b+"-"+h+'" style="display:initial"> (<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';d+='" onclick="wppfm_addCondition('+c+", "+b+", "+h+", '')\">"+wppfm_feed_settings_form_vars.add+"</a>)</span>"}d+="</div>";return d}function wppfm_orConditionSelector(d,b){var c=b.split("#");var e="";var a="";if(c[0]==="static"){e=wppfm_displayCorrectStaticField(d,1,0,_feedHolder.channel,_feedHolder.attributes[d]["fieldName"],c[1]);b="static"}a+="or ";a+=wppfm_alternativeInputFieldCntrl(d,b);a+='<span id="alternative-static-input-'+d+'">'+e+"</span>";a+=" for all other products ";a+='(<a class="edit-prod-source wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-prod-source-'+d+'" onclick="addSource('+d+", 0, '')\">";a+=wppfm_feed_settings_form_vars.edit+"</a>)";return a}function wppfm_ifValueQuerySelector(b,a,d,h,g){var e="";var f=wppfm_isEmptyQueryObject(h)?wppfm_makeCleanQueryObject():h;var c="if ";var i="wppfm_queryValueConditionChanged("+b+", "+a+", "+d+", 0)";if(d>1){c=f.preCondition==="1"?'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2">'+wppfm_feed_settings_form_vars.or+'</option><option value="1" selected>'+wppfm_feed_settings_form_vars.and+"</option></select>":'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2" selected>'+wppfm_feed_settings_form_vars.or+'</option><option value="1">'+wppfm_feed_settings_form_vars.and+"</option></select>"}e+='<div class="value-options-query-selector" id="value-options-condition-'+b+"-"+a+"-"+d+'">';e+=c;e+=wppfm_conditionFieldCntrl(b,a,d,-1,"value-options-input-field-cntrl",f.source,i);e+=wppfm_conditionQueryCntrl(b,a,d,0,"value-query-condition","wppfm_queryValueConditionChanged",f.condition);if(h.condition!=="4"&&h.condition!=="5"){e+='<input type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-options-condition-value" id="value-options-condition-value-';e+=b+"-"+a+"-"+d+'" value="'+f.value+'" style="display:initial">'}if(h.condition!=="14"){e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:none;"> '+wppfm_feed_settings_form_vars.and+" ";e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value"></span>'}else{e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:initial"> '+wppfm_feed_settings_form_vars.and+" ";e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value" value="'+h.endValue+'"></span>'}e+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+b;e+='" onclick="wppfm_removeValueQuery('+b+", "+a+", "+d+')">'+wppfm_feed_settings_form_vars.remove+"</a>)";if(g){e+='<span id="value-options-add-edit-condition-'+b+"-"+a+"-"+d+'" style="display:initial">(<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';e+='" onclick="wppfm_addValueQuery('+b+", "+a+", "+d+", '')\">"+wppfm_feed_settings_form_vars.add+"</a>)</span>"}e+="</div>";return e}function wppfm_addOptionalFieldRow(c){var b="";var a=false;if(c===3){a=_undefinedRecommendedOutputs.length>0?true:false}else{if(c===4){a=_undefinedOptionalOutputs.length>0?true:false}else{if(c===5){a=true}}}if(a===true){if(c===3){b+='<div class="field-table-row-wrapper" id="new-recommended-row" style="display:none;"></div>'}else{if(c===4){b+='<div class="field-table-row-wrapper" id="new-optional-row"></div>'}else{if(c===5){b+='<div class="field-table-row-wrapper" id="new-custom-row"></div>'}}}b+='<div class="field-table-row-top">';b+='<div class="col2w" id="output-select-'+c;b+=c!==5?'" onchange="wppfm_changedOutputSelection('+c+')">'+wppfm_outputFieldCntrl(c):'">'+wppfm_customOutputFieldCntrl();b+="</div></div>"}return b}function wppfm_editOutput(c,b){var a="";a+=wppfm_inputFieldCntrl(c,b,"","",_feedHolder.attributes[c]["advisedSource"],"",false);a+='<div class="field-table-row-combined-selection" id="combined-selectors-'+c+'" style="display:none;"></div>';jQuery("#source-select-"+c+"-"+b).html(a)}function wppfm_removeCondition(g,f,a){_feedHolder.removeValueConditionValue(g,f,a);var b=_feedHolder.getAttributesQueriesObject(g,f);var e=wppfm_countObjectItems(b);for(var d=1;d<e+2;d++){jQuery("#condition-"+g+"-"+f+"-"+d).remove()}if(e>0){for(var c=0;c<e;c++){wppfm_conditionCode(g,f,c,b[c],e)}jQuery("#edit-conditions-"+g).append(wppfm_orSelectorCode(g,""))}else{var h='<div class="condition-wrapper" id="condition-'+g+"-"+f+'-0">'+wppfm_forAllProductsCondition(g,f,"initial")+"</div>";jQuery("#condition-data-"+g+"-"+f).html(h);jQuery("#source-"+g+"-"+(f+1)).remove()}}function wppfm_removeValueQuery(f,e,d){_feedHolder.removeValueQueryValue(f,e,d);var a=_feedHolder.getValueQueryValue(f,e);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[f]["value"]){_feedHolder.deactivateAttribute(f)}jQuery("#value-editor-queries-"+f+"-"+e+"-0").empty();jQuery("#edit-conditions-"+f).empty();if(c>0){for(var b=0;b<c;b++){wppfm_addValueQuery(f,e,b,a[b])}jQuery("#edit-conditions-"+f).append(wppfm_orSelectorCode(f,""))}else{jQuery("#value-editor-input-query-span-"+f+"-"+e+"-0").show();_feedHolder.removeEditValueValue(f,(e+1),0);jQuery("#edit-value-span-"+f+"-"+(e+1)+"-0").remove()}}function wppfm_removeRow(b,d){var c="0";var a=_definedRecommendedOutputs.indexOf(d);c=3;if(a<0){a=_definedOptionalOutputs.indexOf(d);c=4}_feedHolder.deactivateAttribute(b);jQuery("#row-"+b).remove();if(c===3){_definedRecommendedOutputs.splice(a,1);_undefinedRecommendedOutputs.push(d);_undefinedRecommendedOutputs.sort()}else{if(c===4){_definedOptionalOutputs.splice(a,1);_undefinedOptionalOutputs.push(d);_undefinedOptionalOutputs.sort()}}jQuery("#output-field-cntrl-"+c).empty();jQuery("#output-field-cntrl-"+c).html(wppfm_outputFieldCntrl(c))}function wppfm_addCondition(d,c,a,b){var e=wppfm_conditionCode(d,c,a,b,0);if(e){if(a===0){jQuery(wppfm_addFeedSourceRow(d,c+1,_feedHolder.getSourceObject(d))).insertAfter("#source-"+d+"-"+c,false)}if(_feedHolder.attributes[d]["advisedSource"]){_feedHolder.setSourceValue(d,(c+1),_feedHolder.attributes[d]["advisedSource"])}}}function wppfm_conditionCode(c,a,i,g,d){if(g||wppfm_sourceIsFilled(c,a,i)){var j=jQuery("#query-condition-"+c+"-"+a+"-"+i).val();var b=jQuery("#input-field-cntrl-"+c+"-"+a+"-"+i).val();var f=jQuery("#condition-value-"+c+"-"+a+"-"+i).val();var e=false;if(j!=="4"&&j!=="5"&&j!=="14"){if(b==="select"||f===""){e=true}}else{if(j===4||j===5){if(b==="select"){e=true}}}if(e===false||i===0){_feedHolder.incrNrQueries(c);var h=wppfm_queryStringToQueryObject(g);if(i===0){jQuery("#condition-"+c+"-"+a+"-0").remove()}jQuery("#condition-data-"+c+"-"+a).append(wppfm_ifConditionSelector(c,a,i+1,d,h));if(i>0){jQuery("#add-edit-condition-"+c+"-"+a+"-"+i).remove()}return true}else{alert(wppfm_feed_settings_form_vars.fill_current_condition_warning);return false}}else{alert(wppfm_feed_settings_form_vars.select_a_source_field_warning);return false}}function wppfm_addValueQuery(d,a,f,h){if(wppfm_sourceIsFilled(d,a,f)){var i=jQuery("#value-query-condition-"+d+"-"+a+"-"+f+"-0").val();var c=jQuery("#value-options-input-field-cntrl-"+d+"-"+a+"-"+f).val();var g=jQuery("#value-options-condition-value-"+d+"-"+a+"-"+f).val();var e=false;if(i!=="4"&&i!=="5"&&i!=="14"){if(c==="select"||g===""){e=true}}else{if(i===4||i===5){if(c==="select"){e=true}}}if(e===false||a===0){var b=wppfm_queryStringToQueryObject(h);jQuery("#value-options-add-edit-condition-"+d+"-"+a+"-"+f).hide();jQuery("#value-editor-queries-"+d+"-"+a+"-0").append(wppfm_ifValueQuerySelector(d,a,f+1,b,true))}else{alert(wppfm_feed_settings_form_vars.fill_current_condition_warning)}}else{alert(wppfm_feed_settings_form_vars.elect_a_source_field_warning)}}function wppfm_conditionSelectorCode(f,d,e,a,c){var b=wppfm_queryStringToQueryObject(c);return wppfm_ifConditionSelector(f,d,e+1,a,b)}function wppfm_orSelectorCode(d,a){var c="";if(a){for(var b in a){c=a[b]}}return'<div class="or-selector" id="or-selector-'+d+'">'+wppfm_orConditionSelector(d,c)+"</div>"}function wppfm_showEditValueQuery(e,d,b,c){var a={};jQuery("#value-editor-queries-"+e+"-"+d+"-"+b).html(wppfm_ifValueQuerySelector(e,d,b+1,a,c));jQuery("#value-editor-input-query-span-"+e+"-"+d+"-0").hide();if(b===0&&c){wppfm_addRowValueEditor(e,d+1,0,"")}}function wppfm_changedOutput(f,d,h){var b=jQuery("#input-field-cntrl-"+f+"-"+d).val();var g=0;switch(b){case"advised":if(f!==3){var c="";if(h!=="Use the settings in the Merchant Center"){var a=wppfm_sourceOptionsConverter(h);c='<div class="advised-source">'+a+wppfm_editSourceSelector(f,d)+"</div>"}else{c='<div class="advised-source">Use the settings in the Merchant Center '+wppfm_editSourceSelector(f,d)+"</div>"}jQuery("#source-select-"+f+"-"+d).html(c);_feedHolder.clearSourceValue(f,d);_feedHolder.deactivateAttribute(f)}else{var c='<span id="category-source-string">'+_feedHolder.mainCategory+"</span>"+wppfm_editSourceSelector(f,d);_feedHolder.setCategoryValue(f,_feedHolder.mainCategory);jQuery("#source-select-"+f+"-"+d).html(c)}break;case"static":jQuery("#source-select-"+f+"-"+d).append(wppfm_displayCorrectStaticField(f,d,0,_feedHolder.channel,_feedHolder.attributes[f]["fieldName"],""));jQuery("#combined-wrapper-"+f+"-"+d).remove();var e=jQuery("#static-input-field-"+f+"-"+d+"-"+g).val()?jQuery("#static-input-field-"+f+"-"+d+"-"+g).val():jQuery("#static-condition-input-"+f+"-"+d+"-"+g+" option:selected").val();_feedHolder.setStaticAttributeValue(f,d,g,e);if(e||d>0){_feedHolder.activateAttribute(f)}else{_feedHolder.deactivateAttribute(f)}break;case"select":_feedHolder.clearSourceValue(f,d);if(d==="0"){_feedHolder.deactivateAttribute(f)}jQuery("#static-input-field-"+f+"-"+d+"-"+g).remove();jQuery("#static-condition-input-"+f+"-"+d+"-"+g).remove();jQuery("#combined-wrapper-"+f+"-"+d).remove();wppfm_clearStaticField(f);break;case"combined":_feedHolder.setSourceValue(f,d,b);if(d==="0"){_feedHolder.deactivateAttribute(f)}jQuery("#static-input-field-"+f+"-"+d+"-"+g).remove();jQuery("#static-condition-input-"+f+"-"+d+"-"+g).remove();wppfm_addCombinedField(f,d,0);break;case"category_mapping":_feedHolder.setCustomCategory(f,_feedHolder.mainCategory);jQuery("#static-input-field-"+f+"-"+d+"-"+g).remove();jQuery("#static-condition-input-"+f+"-"+d+"-"+g).remove();jQuery("#combined-wrapper-"+f+"-"+d).remove();jQuery("#condition-"+f+"-"+d+"-0").remove();jQuery("#value-editor-input-query-add-span-"+f+"-"+d+"-0").hide();jQuery("#source-select-"+f+"-"+d).html(wppfm_categorySource());break;default:jQuery("#static-input-"+f).html("");if(b===h&&d==="0"&&jQuery("#input-field-cntrl-"+f+"-"+d+"-0").val()==="select"){_feedHolder.clearSourceValue(f,d)}else{_feedHolder.setSourceValue(f,d,b)}_feedHolder.activateAttribute(f);_feedHolder.attributes[f]["isActive"]=true;jQuery("#static-input-field-"+f+"-"+d+"-"+g).remove();jQuery("#static-condition-input-"+f+"-"+d+"-"+g).remove();jQuery("#combined-wrapper-"+f+"-"+d).remove();break}}function wppfm_changedAlternativeSource(c){var d=1;var a=jQuery("#alternative-input-field-cntrl-"+c).val();if(a==="static"){var b=wppfm_displayCorrectStaticField(c,_feedHolder.channel,d,_feedHolder.attributes[c]["fieldName"],"");jQuery("#alternative-static-input-"+c).html(b)}else{jQuery("#alternative-static-input-"+c).empty();if(a!=="select"&&a!=="empty"){_feedHolder.setAlternativeSourceValue(c,d,a)}else{_feedHolder.removeAlternativeSourceValue(c,d)}}}function wppfm_changedCombinationSeparator(b,a,c){wppfm_changedCombinedOutput(b,a,c)}function wppfm_changedCombinedOutput(e,d,f){var b=jQuery("#combined-input-field-cntrl-"+e+"-"+d+"-"+f).val();var a="";switch(b){case"static":if(!jQuery("#static-input-field-"+e+"-"+d+"-"+f).val()){var c=wppfm_displayCorrectStaticField(e,d,f,_feedHolder.channel,_feedHolder.attributes[e]["fieldName"],"");jQuery("#static-value-control-"+e+"-"+d+"-"+f).html(c)}break;default:jQuery("#static-value-control-"+e+"-"+d+"-"+f).empty();break}a=getCombinedValue(e,d);if(a){_feedHolder.setCombinedOutputValue(e,d,a);_feedHolder.activateAttribute(e)}else{_feedHolder.removeCombinedOutputValue(e,d,f);if(d==="0"){_feedHolder.deactivateAttribute(e)}}}function wppfm_removeCombinedField(f,d,c){_feedHolder.removeCombinedOutputValue(f,d,c);var b=JSON.parse(_feedHolder.attributes[f]["value"]);var e="m" in b?b.m:{};var a=wppfm_getMappingCombinedValue(e,d);jQuery("#source-select-"+f+"-"+d).append(wppfm_combinedField(f,d,c,a,false))}function wppfm_clearStaticField(a){jQuery("#static-input-"+a).html("")}function wppfm_storeValueCondition(d,k,f){var a=jQuery("#value-options-input-field-cntrl-"+d+"-"+k+"-"+f).val();if(a!=="select"){var i;var j=f>1?jQuery("#value-options-sub-query-"+d+"-"+k+"-"+f+" option:selected").val():"0";var c=jQuery("#value-query-condition-"+d+"-"+k+"-"+f+"-0 option:selected").val();var h=c!=="4"&&c!=="5"?jQuery("#value-options-condition-value-"+d+"-"+k+"-"+f).val():"";var e=c==="14"?jQuery("#value-options-condition-and-value-input-"+d+"-"+k+"-"+f).val():"";if(c==="4"||c==="5"){i=true}else{if(c==="14"){i=h&&e?true:false}else{i=h?true:false}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+c;if(h){g+="#"+h}if(e){g+="#0#"+e}_feedHolder.addValueQueryValue(d,k,f,g)}}else{console.log("Query "+d+"-"+k+"-"+f+" removed!");_feedHolder.removeValueQueryValue(d,k,f)}}function wppfm_storeCondition(e,c,k){var a=jQuery("#input-field-cntrl-"+e+"-"+c+"-"+k).val();var l=false;if(wppfm_validSourceSelected(e,c)){if(a!=="select"){var i;var j=k>1?jQuery("#sub-condition-"+e+"-"+c+"-"+k+" option:selected").val():"0";var d=jQuery("#query-condition-"+e+"-"+c+"-"+k+" option:selected").val();var h=d!=="4"&&d!=="5"?jQuery("#condition-value-"+e+"-"+c+"-"+k).val():"";var f=d==="14"?jQuery("#condition-and-value-input-"+e+"-"+c+"-"+k).val():"";if(d==="4"||d==="5"){i=true}else{if(d==="14"){i=h&&f?true:false}else{i=h?true:false}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+d;if(h){g+="#"+h}if(f){g+="#0#"+f}_feedHolder.addConditionValue(e,g,c,k);l=true}}else{_feedHolder.removeValueConditionValue(e,c,k)}}else{jQuery("#input-field-cntrl-"+e+"-"+c+"-1").prop("selectedIndex",0);jQuery("#condition-value-"+e+"-"+c+"-1").val("");alert(wppfm_feed_settings_form_vars.select_a_valid_source_warning)}return l}function wppfm_validSourceSelected(c,b){var a=jQuery("#input-field-cntrl-"+c+"-"+b).val();switch(a){case"select":return false;case"static":if(jQuery("#static-condition-input-"+c+"-"+b+"-0").val()){return jQuery("#static-condition-input-"+c+"-"+b+"-0").val()?true:false}else{if(jQuery("#static-input-field-"+c+"-"+b+"-0").val()){return jQuery("#static-input-field-"+c+"-"+b+"-0").val()?true:false}else{return false}}case"combined":return jQuery("#combined-input-field-cntrl-"+c+"-"+b+"-2").val()!=="select"?true:false;default:return true}}function wppfm_valueInputOptionsChanged(d,b,g){var f=jQuery("#value-options-"+d+"-"+b+"-"+g+" option:selected").text();var h=jQuery("#value-options-input-"+d+"-"+b+"-"+g).val();var i="";var e=b>0?"and":"change";if(f!=="replace"&&f!=="recalculate"){i=e+"#"+f+"#";i+=f==="change nothing"?"blank":h;_feedHolder.addChangeValue(d,b,g,i)}else{if(f==="replace"){var a=jQuery("#value-options-input-with-"+d+"-"+b+"-"+g).val();if(h&&a){i=e+"#"+f+"#"+h+"#"+a;_feedHolder.addChangeValue(d,b,g,i)}}else{if(f==="recalculate"){var c=jQuery("#value-options-recalculate-options-"+d+"-"+b+"-"+g+" option:selected").text();if(h){i=e+"#"+f+"#"+c+"#"+h;_feedHolder.addChangeValue(d,b,g,i)}}}}}function wppfm_removeValueEditor(e,d,f){_feedHolder.removeEditValueValue(e,d,f);var a=_feedHolder.getAttributesValueObject(e);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[e]["value"]){_feedHolder.deactivateAttribute(e)}jQuery("#edit-value-span-"+e+"-"+d+"-0").remove();if(c>0){for(var b=1;b<c;b++){wppfm_addRowValueEditor(e,d,b,a[b])}}else{jQuery("#value-editor-"+e+"-"+d+"-"+f).remove();jQuery("#source-"+e+"-"+d).append(wppfm_editValueSpan(e,d,f,"initial"))}}function wppfm_makeFieldsTable(){var b=_feedHolder.channel.toString();wppfm_resetFields();for(var a=0;a<_feedHolder.attributes.length;a++){switch(_feedHolder.attributes[a]["fieldLevel"]){case"1":_mandatoryFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"2":_highlyRecommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"3":if(_feedHolder.attributes[a]["isActive"]){_recommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"4":if(_feedHolder.attributes[a]["isActive"]){_optionalFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"5":if(_feedHolder.attributes[a]["isActive"]){_customFields+=wppfm_fieldRow(_feedHolder.attributes[a],true)}else{_undefinedCustomOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;default:break}}_definedRecommendedOutputs.sort();_undefinedRecommendedOutputs.sort();_recommendedFields+=wppfm_addOptionalFieldRow(3);_optionalFields+=wppfm_addOptionalFieldRow(4);if(wppfm_isCustomChannel(b)){_customFields+=wppfm_addOptionalFieldRow(5)}if(_mandatoryFields.length>0){jQuery("#required-field-table").html(_mandatoryFields);jQuery("#required-fields").show()}else{jQuery("#required-fields").hide()}if(_highlyRecommendedFields.length>0){jQuery("#highly-recommended-field-table").html(_highlyRecommendedFields);jQuery("#highly-recommended-fields").show()}else{jQuery("#highly-recommended-fields").hide()}if(_recommendedFields.length>0){jQuery("#recommended-field-table").html(_recommendedFields);jQuery("#recommended-fields").show()}else{jQuery("#recommended-fields").hide()}if(_optionalFields.length>0){jQuery("#optional-field-table").html(_optionalFields);jQuery("#optional-fields").show()}else{jQuery("#optional-fields").hide()}if(_customFields.length>0){jQuery("#custom-field-table").html(_customFields);jQuery("#custom-fields").show()}else{jQuery("#custom-fields").hide()}jQuery("#fields-form").show(300)}function wppfm_resetFields(){_mandatoryFields=[];_highlyRecommendedFields=[];_recommendedFields=[];_undefinedRecommendedOutputs=[];_optionalFields=[];_undefinedOptionalOutputs=[];_customFields=[];_undefinedCustomOutputs=[]}function wppfm_queryConditionChanged(e,d,a){var c=jQuery("#query-condition-"+e+"-"+d+"-"+a).val();if(c==="4"||c==="5"){jQuery("#condition-value-"+e+"-"+d+"-"+a).hide()}else{jQuery("#condition-value-"+e+"-"+d+"-"+a).show()}if(c==="14"){jQuery("#condition-value-"+e+"-"+d+"-"+a).show();jQuery("#condition-and-value-"+e+"-"+d+"-"+a).show()}else{jQuery("#condition-and-value-"+e+"-"+d+"-"+a).hide()}var b=wppfm_storeCondition(e,d,a);if(b&&!jQuery("#source-"+e+"-"+(d+1)).length){jQuery(wppfm_addFeedSourceRow(e,d+1,_feedHolder.getSourceObject(e))).insertAfter("#source-"+e+"-"+d,false)}}function wppfm_queryValueConditionChanged(e,c,a,d){var b=jQuery("#value-query-condition-"+e+"-"+c+"-"+a+"-"+d).val();if(b==="4"||b==="5"){jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).hide()}else{jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).show()}if(b==="14"){jQuery("#value-options-condition-value-"+e+"-"+c+"-"+a).show();jQuery("#value-options-condition-and-value-"+e+"-"+c+"-"+a).show()}else{jQuery("#value-options-condition-and-value-"+e+"-"+c+"-"+a).hide()}wppfm_storeValueCondition(e,c,a)}function wppfm_feed_update_finished(){console.log("Feed update finished")}function wppfm_getOutputFieldsList(d){var c="";var b=[];switch(d){case 3:b=_undefinedRecommendedOutputs;break;case 4:b=_undefinedOptionalOutputs;break;default:break}b.sort();for(var a=0;a<b.length;a++){c+='<option value="'+b[a]+'">'+b[a]+"</option>"}return c}function wppfm_fixedSourcesList(b){var d="";var c="";for(var a=0;a<_inputFields.length;a++){c=b===_inputFields[a].value?" selected":"";d+='<option value = "'+_inputFields[a].value+'" itemprop="'+_inputFields[a].prop+'" '+c+">"+_inputFields[a].label+"</option>"}return d}function wppfm_hideFeedFormMainInputs(){jQuery("#category-list-row").hide();jQuery("#aggregator-selector-row").hide();jQuery("#add-product-variations-row").hide()}function wppfm_editFeedFilter(){alert(wppfm_feed_settings_form_vars.advanced_filter_only_for_premium)}function wppfm_makeFeedFilterWrapper(a,b){var c=wppfm_feed_settings_form_vars.all_products_included;c+='<span id="filter-edit-text" style="display:initial;"> (<a class="edit-feed-filter wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-feed-filters-'+a;c+='" onclick="wppfm_editFeedFilter()">'+wppfm_feed_settings_form_vars.edit+"</a>)</span>";jQuery(".product-filter-condition-wrapper").html(c);jQuery(".main-product-filter-wrapper").show()}function wppfm_getCombinedSeparatorList(b){var a={"0":"-- "+wppfm_feed_settings_form_vars.no_separator+" --","1":wppfm_feed_settings_form_vars.space,"2":wppfm_feed_settings_form_vars.comma,"3":wppfm_feed_settings_form_vars.point,"4":wppfm_feed_settings_form_vars.semicolon,"5":wppfm_feed_settings_form_vars.colon,"6":wppfm_feed_settings_form_vars.dash,"7":wppfm_feed_settings_form_vars.slash,"8":wppfm_feed_settings_form_vars.backslash,"9":wppfm_feed_settings_form_vars.double_pipe,"10":wppfm_feed_settings_form_vars.underscore};var c="";for(var d in a){if(d!==b){c+='<option value="'+d+'">'+a[d]+"</option>"}else{c+='<option value="'+d+'" selected>'+a[d]+"</option>"}}return c}function updateFeedFormAfterInputChanged(a,b){wppfm_enableFeedActionButtons();wppfm_finishOrUpdateFeedPage(b);if(a===undefined||a<1){wppfm_constructNewFeed()}}jQuery(document).ready(function(){var a=wppfm_getUrlVariable("id");_feedHolder=new Feed();if(""!==a){wppfm_editExistingFeed(a)}});